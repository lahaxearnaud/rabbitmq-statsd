<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rabbitmq-statsd by lahaxearnaud</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Rabbitmq-statsd</h1>
        <p>Amqp queue information to statsd </p>

        <p class="view"><a href="https://github.com/lahaxearnaud/rabbitmq-statsd">View the Project on GitHub <small>lahaxearnaud/rabbitmq-statsd</small></a></p>


        <ul>
          <li><a href="https://github.com/lahaxearnaud/rabbitmq-statsd/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/lahaxearnaud/rabbitmq-statsd/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/lahaxearnaud/rabbitmq-statsd">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="rabbitmq-statsd" class="anchor" href="#rabbitmq-statsd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>rabbitmq-statsd</h1>

<blockquote>
<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>
</blockquote>

<p><img src="/data/queues.png?raw=true" alt="Alt text" title="Queues keys"></p>

<p><img src="/data/stats.png?raw=true" alt="Alt text" title="Stats keys"></p>

<blockquote>
<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
</blockquote>

<p>In the <a href="https://github.com/lahaxearnaud/rabbitmq-statsd/blob/master/config.json">config.json</a> file you will find all the application configuration</p>

<div class="highlight highlight-source-js"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>collectInterval<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">30000</span>, <span class="pl-c">// collect interval time in ms</span>
    <span class="pl-s"><span class="pl-pds">"</span>amqp<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>AMQP_USERNAME<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>AMQP_PASSWORD<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>AMQP_HOSTNAME:15672<span class="pl-pds">"</span></span>, <span class="pl-c">// might be something like heroku.srs.rabbitmq.com/rabbitmq/foobar</span>
        <span class="pl-s"><span class="pl-pds">"</span>protocol<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>HTTP_OR_HTTPS<span class="pl-pds">"</span></span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>statsd<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>STATSD_HOSTNAME<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>8125<span class="pl-pds">"</span></span>, <span class="pl-c">// port of your statsd</span>
        <span class="pl-s"><span class="pl-pds">"</span>prefix<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>STATSD_PREFIX<span class="pl-pds">"</span></span> <span class="pl-c">// prefix for your stats ex rabbit.prod / rabbit.dev</span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>logPath<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>rabbit.log<span class="pl-pds">"</span></span>
}</pre></div>

<blockquote>
<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>
</blockquote>

<p>Clone the remository</p>

<div class="highlight highlight-source-shell"><pre>$ git clone https://github.com/lahaxearnaud/rabbitmq-statsd</pre></div>

<h2>
<a id="run-with-docker-on-arm-architecture-based-on-armbuildalpine" class="anchor" href="#run-with-docker-on-arm-architecture-based-on-armbuildalpine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run with docker on arm architecture (based on armbuild/alpine)</h2>

<p>Docker images: 47MB</p>

<ul>
<li>Build the image</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ make build</pre></div>

<pre><code>docker build -t rabbitmq-collector /home/pirate/domotique-rabbitmq-statsd
Sending build context to Docker daemon 2.842 MB
Step 1 : FROM resin/armhf-alpine-node:slim
 ---&gt; 3e890d09a3d8
Step 2 : RUN npm install forever -g
 ---&gt; Using cache
 ---&gt; a8ee4752aca3
Successfully built a8ee4752aca3

</code></pre>

<ul>
<li>Start the container</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ make up</pre></div>

<pre><code>docker rm rabbitmq-collector-container | true
docker run --name rabbitmq-collector-container -v /home/pirate/domotique-rabbitmq-statsd:/var/app -d rabbitmq-collector forever /var/app/app.js
4645aa2efcc4946924be0faa8237e4163ba5a2771ef9b72d488ff4e22e79e610
</code></pre>

<ul>
<li>Access container logs</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ make tail</pre></div>

<pre><code>docker logs -f rabbitmq-collector-container
warn:    --minUptime not set. Defaulting to: 1000ms
warn:    --spinSleepTime not set. Your script will exit if it does not stay up for at least 1000ms
info: Rabbit monitoring starting

</code></pre>

<ul>
<li>Stop the container</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ make down

docker <span class="pl-c1">kill</span> rabbitmq-collector-container <span class="pl-k">|</span> <span class="pl-c1">true</span>
</pre></div>

<ul>
<li>Remove the image</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ make rm</pre></div>

<pre><code>docker kill rabbitmq-collector-container | true
Error response from daemon: Cannot kill container rabbitmq-collector-container: Container 4645aa2efcc4946924be0faa8237e4163ba5a2771ef9b72d488ff4e22e79e610 is not running
docker rmi rabbitmq-collector
Untagged: rabbitmq-collector:latest

</code></pre>

<h2>
<a id="run-without-docker-with-forever" class="anchor" href="#run-without-docker-with-forever" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run without docker with forever</h2>

<div class="highlight highlight-source-shell"><pre>$ forver start app.js
</pre></div>

<h2>
<a id="run-without-docker-and-without-forever" class="anchor" href="#run-without-docker-and-without-forever" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run without docker and without forever</h2>

<div class="highlight highlight-source-shell"><pre>$ npm run app
</pre></div>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<p>Pull requests and stars are always welcome. For bugs and feature requests, <a href="https://github.com/lahaxearnaud/rabbitmq-statsd/issues">please create an issue</a></p>

<h2>
<a id="author" class="anchor" href="#author" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Author</h2>

<p><strong>LAHAXE Arnaud</strong></p>

<ul>
<li><a href="https://github.com/lahaxearnaud">github/lahaxearnaud</a></li>
<li><a href="http://twitter.com/arnaud_lahaxe">twitter/arnaud_lahaxe</a></li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>Copyright Â© 2016 <a href="">LAHAXE Arnaud</a>
Licensed under the MIT license.</p>

<hr>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/lahaxearnaud">lahaxearnaud</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
